<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Cafe Arkady</title>
    <link rel="stylesheet" href="../css/ciasta.css">
</head>
<body>
    <div class="nawigacja">
        <a href="main.html">GWNA</a>
        <a href="menu.html">MENU</a>
        <a href="sezon.html">SEZONOWE</a>
        <a href="zesp贸.html">ZESP</a>
        <a href="ciasta.html">CIASTA</a>
        <a href="torty.html">TORTY</a>
        <a href="sala.html">SALA</a>
        <a href="mieszkania.html">MIESZKANIA</a>
    </div>

    <div class="galeria-ciast">
        <h1>Nasze ciasta</h1>

        <div class="element-ciast">
            <img src="../img/ciasta/c1.JPG" alt="Keto brownie pistacjowe" data-index="0" onclick="openLightbox(0)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c2.JPG" alt="Sernik mango marakuja" data-index="1" onclick="openLightbox(1)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c3.JPG" alt="Liwia" data-index="2" onclick="openLightbox(2)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c4.JPG" alt="Szymon" data-index="3" onclick="openLightbox(3)">
        </div> 
        <div class="element-ciast">
            <img src="../img/ciasta/c5.JPG" alt="Samanta" data-index="4" onclick="openLightbox(4)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c6.JPG" alt="Pani Mirela" data-index="5" onclick="openLightbox(5)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c7.JPG" alt="Agata" data-index="6" onclick="openLightbox(6)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c8.JPG" alt="Hania" data-index="7" onclick="openLightbox(7)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c9.JPG" alt="Dawid" data-index="8" onclick="openLightbox(8)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c10.JPG" alt="Filip" data-index="9" onclick="openLightbox(9)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c11.JPG" alt="Ciasto 11" data-index="10" onclick="openLightbox(10)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c12.JPG" alt="Ciasto 12" data-index="11" onclick="openLightbox(11)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c13.JPG" alt="Ciasto 13" data-index="12" onclick="openLightbox(12)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c14.JPG" alt="Ciasto 14" data-index="13" onclick="openLightbox(13)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c15.JPG" alt="Ciasto 15" data-index="14" onclick="openLightbox(14)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c18.JPG" alt="Ciasto 16" data-index="15" onclick="openLightbox(15)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c17.JPG" alt="Ciasto 17" data-index="16" onclick="openLightbox(16)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c16.JPG" alt="Ciasto 18" data-index="17" onclick="openLightbox(17)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c19.JPG" alt="Ciasto 19" data-index="18" onclick="openLightbox(18)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c20.JPG" alt="Ciasto 20" data-index="19" onclick="openLightbox(19)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c21.JPG" alt="Ciasto 21" data-index="20" onclick="openLightbox(20)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c22.JPG" alt="Ciasto 22" data-index="21" onclick="openLightbox(21)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c23.JPG" alt="Ciasto 23" data-index="22" onclick="openLightbox(22)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c24.JPG" alt="Ciasto 24" data-index="23" onclick="openLightbox(23)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c25.JPG" alt="Ciasto 25" data-index="24" onclick="openLightbox(24)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c26.JPG" alt="Ciasto 26" data-index="25" onclick="openLightbox(25)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c27.JPG" alt="Ciasto 27" data-index="26" onclick="openLightbox(26)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c28.JPG" alt="Ciasto 28" data-index="27" onclick="openLightbox(27)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c29.JPG" alt="Ciasto 29" data-index="28" onclick="openLightbox(28)">
        </div>
        <div class="element-ciast">
            <img src="../img/ciasta/c30.JPG" alt="Ciasto 30" data-index="29" onclick="openLightbox(29)">
        </div>
        </div>

    <div class="sekcja-formularza-torty"> 
        <h2>Z贸偶 Szybkie Zam贸wienie Ciasta</h2>
        
        <form id="zamowienieCiastaFormularz">
            
            <div class="form-group row-fields">
                <div class="half-field">
                    <label for="ciasto_wybor">Wybierz Ciasto / Ciastko*</label>
                    <select id="ciasto_wybor" name="ciasto_wybor" required>
                        <option value="" disabled selected>--- Wybierz z listy ---</option>
                        <option value="Sernik Klasyczny">Sernik Klasyczny (porcja)</option>
                        <option value="Szarlotka Kruszonka">Szarlotka z Kruszonk (porcja)</option>
                        <option value="Ciasto Czekoladowe">Ciasto Czekoladowe (porcja)</option>
                        <option value="Tiramisu">Tiramisu (porcja)</option>
                        <option value="Red Velvet">Red Velvet (porcja)</option>
                        <option value="Pavlova">Pavlova (porcja)</option>
                        <option value="Brownie">Brownie (porcja)</option>
                        <option value="Makowiec">Makowiec (porcja)</option>
                        <option value="Karpatka">Karpatka (porcja)</option>
                        <option value="Pczek Du偶y">Pczek Du偶y (sztuka)</option>
                        <option value="Tort Bezowy (cay)">Tort Bezowy (cay)</option>
                        <option value="Cay Sernik (na wag)">Cay Sernik (na wag)</option>
                    </select>
                </div>
                <div class="half-field">
                    <label for="ilosc">Ilo / Waga (sztuki / kg)*</label>
                    <input type="number" id="ilosc" name="ilosc" min="1" step="1" required placeholder="np. 4 (szt.) lub 2 (kg)">
                </div>
            </div>

            <div class="form-group kalendarz-grupa">
                <label>Wybierz Dat Odbioru* (min. 3 dni robocze)</label>
                <div id="kalendarzCiasta"></div>
                <input type="hidden" id="wybranaDataCiasta" name="data_odbioru" required>
                <p class="data-info">Terminy oznaczone na czerwono s **zablokowane**.</p>
            </div>
            
            <div class="form-group">
                <label for="uwagi">Dodatkowe Uwagi (np. godzina odbioru)</label>
                <textarea id="uwagi" name="uwagi" rows="3" placeholder="np. Odbi贸r okoo godziny 14:00, proba o bezglutenowy zamiennik."></textarea>
            </div>

            <p class="podsumowanie-kwoty">Szacowana kwota: <strong id="szacowanaKwota">---</strong> z</p>

            <button type="submit" class="submit-btn">Wylij Zapytanie o Zam贸wienie</button>
        </form>
        
        <p class="klauzula">*Po klikniciu przycisku otrzymasz wiadomo do skopiowania i wysania.</p>
    </div>

    <div class="kontakt">
        <div class="kontakt-content">
            <div class="info-group">
                <div class="kontakt-info">
                    <h3>Kontakt</h3>
                    <p>
                         Email: <a href="mailto:arkady.socialmedia@gmail.com">arkady.socialmedia@gmail.com</a><br>
                         Adres: ul. Zamehofa 44E, 72-010 Police
                    </p>
                </div>
                <div class="godziny">
                    <h3>Godziny Otwarcia</h3>
                    <p>
                        Poniedziaek - Czwartek: 10:00 - 19:00<br>
                        Pitek: 10:00 - 20:00<br>
                        Sobota - Niedziela: 9:00 - 20:00
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="ciastaLightbox" class="lightbox-ciasta" onclick="closeLightboxOnOuterClick(event)">
        <div class="lightbox-content-wrapper">
            <span class="lightbox-close-btn" onclick="closeLightbox()">&times;</span>
            <a class="lightbox-nav-btn prev-btn" onclick="changeSlide(-1)">&#10094;</a>
            <img id="lightboxImage" src="" alt="Powikszone ciasto">
            <p id="lightboxCaption"></p>
            <a class="lightbox-nav-btn next-btn" onclick="changeSlide(1)">&#10095;</a>
        </div>
    </div>

<script>
    // --- SKRYPT DLA KALENDARZA I LOGIKI ---

    const formularzCiasta = document.getElementById('zamowienieCiastaFormularz');
    const kalendarzDivCiasta = document.getElementById('kalendarzCiasta');
    const wybranaDataCiastaInput = document.getElementById('wybranaDataCiasta');
    const iloscInput = document.getElementById('ilosc');
    const ciastoSelect = document.getElementById('ciasto_wybor');
    const szacowanaKwotaCiasta = document.getElementById('szacowanaKwota');
    
    // STAE CENY
    const CENA_PORCJA = 16.00; 
    const CENA_TORT_BEZOWY_KG = 170.00;
    const CENA_SERNIK_CALY_KG = 160.00;

    let zablokowaneDaty = [];

    // Mapowanie cen dla wybranych opcji
    const cennik = {
        'Sernik Klasyczny': CENA_PORCJA,
        'Szarlotka Kruszonka': CENA_PORCJA,
        'Ciasto Czekoladowe': CENA_PORCJA,
        'Tiramisu': CENA_PORCJA,
        'Red Velvet': CENA_PORCJA,
        'Pavlova': CENA_PORCJA,
        'Brownie': CENA_PORCJA,
        'Makowiec': CENA_PORCJA,
        'Karpatka': CENA_PORCJA,
        'Pczek Du偶y': 9.00, 
        'Tort Bezowy (cay)': CENA_TORT_BEZOWY_KG,
        'Cay Sernik (na wag)': CENA_SERNIK_CALY_KG,
    };
    
    // 1. Logika obliczania kwoty
    function obliczSzacowanaKwota() {
        const ilosc = parseFloat(iloscInput.value) || 0;
        const wybraneCiasto = ciastoSelect.value;
        let cenaJednostkowa = cennik[wybraneCiasto] || 0; 

        if (ilosc === 0 || cenaJednostkowa === 0) {
            szacowanaKwotaCiasta.textContent = '---';
            return;
        }

        let kwota = ilosc * cenaJednostkowa;

        // Logika dostosowania placeholder
        if (wybraneCiasto.includes('(cay)') || wybraneCiasto.includes('(na wag)')) {
            iloscInput.placeholder = 'Waga w kg (np. 2)';
            iloscInput.step = '0.5';
        } else {
            iloscInput.placeholder = 'Ilo sztuk (np. 4)';
            iloscInput.step = '1';
        }

        szacowanaKwotaCiasta.textContent = kwota.toFixed(2);
    }

    iloscInput.addEventListener('input', obliczSzacowanaKwota);
    ciastoSelect.addEventListener('change', obliczSzacowanaKwota);

    // 2. Pobieranie zablokowanych dat
    async function pobierzZablokowaneDaty() {
        try {
            const response = await fetch('zablokowane_daty.json');
            if (response.ok) {
                const data = await response.json();
                zablokowaneDaty = data.zablokowane;
            }
        } catch (error) {
            console.error('Bd adowania zablokowanych dat. U偶ywam pustej listy.');
            zablokowaneDaty = []; 
        }
    }

    // 3. Generowanie kalendarza z minimalnym terminem 3 dni roboczych
    function generujKalendarz() {
        const dzisiaj = new Date();
        const minData = new Date();
        minData.setDate(dzisiaj.getDate() + 3); // Minimalny czas zam贸wienia: 3 dni
        
        const biezacyMiesiac = dzisiaj.getMonth();
        const biezacyRok = dzisiaj.getFullYear();
        
        kalendarzDivCiasta.innerHTML = ''; 

        for (let m = 0; m < 2; m++) { // Generujemy 2 miesice
            const dataMiesiac = new Date(biezacyRok, biezacyMiesiac + m, 1);
            const nazwaMiesiaca = dataMiesiac.toLocaleString('pl-PL', { month: 'long', year: 'numeric' });
            
            let html = `<div class="miesiac-kalendarz"><p class="nazwa-miesiaca">${nazwaMiesiaca}</p><div class="dni-tygodnia"><span>Pon</span><span>Wt</span><span>r</span><span>Czw</span><span>Pt</span><span>Sob</span><span>Ndz</span></div><div class="dni">`;
            
            let pierwszyDzienMiesiaca = (dataMiesiac.getDay() + 6) % 7; 
            for (let i = 0; i < pierwszyDzienMiesiaca; i++) {
                html += '<span></span>';
            }

            let dzien = 1;
            while (new Date(biezacyRok, biezacyMiesiac + m, dzien).getMonth() === biezacyMiesiac + m) {
                const dataPelna = new Date(biezacyRok, biezacyMiesiac + m, dzien);
                const dataString = `${dataPelna.getFullYear()}-${String(dataPelna.getMonth() + 1).padStart(2, '0')}-${String(dzien).padStart(2, '0')}`;
                
                let klasa = 'dzien';
                
                // Blokowanie dat
                if (zablokowaneDaty.includes(dataString)) {
                    klasa += ' zablokowany';
                }
                // Dni nieaktywne (przesze lub przed minimalnym terminem)
                if (dataPelna < minData || zablokowaneDaty.includes(dataString)) {
                    klasa += ' nieaktywny';
                }
                
                html += `<span class="${klasa}" data-data="${dataString}">${dzien}</span>`;
                dzien++;
            }
            html += '</div></div>';
            kalendarzDivCiasta.innerHTML += html;
        }
        
        dodajListeneryDoDni();
    }

    // 4. Obsuga klikni i stylizacja aktywnego dnia
    function dodajListeneryDoDni() {
        document.querySelectorAll('#kalendarzCiasta .dzien:not(.zablokowany):not(.nieaktywny)').forEach(dzienElement => {
            dzienElement.addEventListener('click', function() {
                document.querySelectorAll('#kalendarzCiasta .dzien.wybrany').forEach(el => el.classList.remove('wybrany'));
                this.classList.add('wybrany');
                wybranaDataCiastaInput.value = this.getAttribute('data-data');
            });
        });
    }

    // --- PRZYPISANIE STYLW CSS KALENDARZA (Z TORTW) ---
    const style = document.createElement('style');
    style.textContent = `
        .miesiac-kalendarz { margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
        .nazwa-miesiaca { text-align: center; font-weight: bold; margin-bottom: 10px; color: #0c113d; }
        .dni-tygodnia, .dni { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; }
        .dni-tygodnia span { font-weight: bold; color: #555; }
        .dzien { padding: 8px 0; cursor: pointer; transition: background-color 0.2s; border-radius: 4px; }
        .dzien:hover:not(.zablokowany):not(.nieaktywny) { background-color: #eee; }
        .dzien.zablokowany { background-color: #fdd; color: #c00; text-decoration: line-through; cursor: not-allowed; }
        .dzien.nieaktywny { color: #ccc; cursor: not-allowed; }
        .dzien.wybrany { background-color: #0c113d; color: white; font-weight: bold; }
    `;
    document.head.appendChild(style);

    // --- URUCHOMIENIE ---
    (async function() {
        await pobierzZablokowaneDaty();
        generujKalendarz();
        obliczSzacowanaKwota();
    })();

    // --- LOGIKA LIGHTBOXA (ZAPEWNIENIE KOMPLETNOCI) ---
    let currentSlideIndex = 0;
    const cakeImages = Array.from(document.querySelectorAll('.element-ciast img'));
    
    function openLightbox(index) {
        currentSlideIndex = index;
        updateLightbox();
        document.getElementById('ciastaLightbox').style.display = "block";
    }

    function closeLightbox() {
        document.getElementById('ciastaLightbox').style.display = "none";
    }

    function changeSlide(n) {
        currentSlideIndex += n;
        if (currentSlideIndex < 0) {
            currentSlideIndex = cakeImages.length - 1;
        } else if (currentSlideIndex >= cakeImages.length) {
            currentSlideIndex = 0;
        }
        updateLightbox();
    }

    function updateLightbox() {
        const imgElement = cakeImages[currentSlideIndex];
        document.getElementById('lightboxImage').src = imgElement.src;
        document.getElementById('lightboxCaption').textContent = imgElement.alt;
    }

    function closeLightboxOnOuterClick(event) {
        if (event.target === document.getElementById('ciastaLightbox')) {
            closeLightbox();
        }
    }
</script>

</body>
</html>